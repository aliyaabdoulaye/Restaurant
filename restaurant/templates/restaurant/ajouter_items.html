{% extends 'restaurant/base.html' %}

{% block title %}Ajouter des plats - Restaurant Pro{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-800">Commande #{{ commande.id }}</h1>
        <p class="text-gray-600">Table {{ commande.table.numero }} • {{ commande.serveur.get_full_name }}</p>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Formulaire d'ajout -->
        <div class="lg:col-span-2">
            <div class="bg-white rounded-lg shadow-xl p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Ajouter un plat</h2>
                
                <form method="post" class="space-y-4">
                    {% csrf_token %}
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">Plat *</label>
                        {{ form.plat }}
                        {% if form.plat.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.plat.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">Quantité *</label>
                        {{ form.quantite }}
                        {% if form.quantite.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.quantite.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">Notes (cuisson, allergies...)</label>
                        {{ form.notes }}
                        {% if form.notes.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.notes.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <button type="submit" class="w-full bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 font-bold">
                        <i class="fas fa-plus mr-2"></i>Ajouter à la commande
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Récapitulatif -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-lg shadow-xl p-6 sticky top-4">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Récapitulatif</h2>
                
                <div class="space-y-3 mb-6">
                    {% for item in items %}
                    <div class="flex justify-between items-start p-3 bg-gray-50 rounded-lg">
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800">{{ item.quantite }}x {{ item.plat.nom }}</p>
                            {% if item.notes %}
                            <p class="text-xs text-gray-600">{{ item.notes }}</p>
                            {% endif %}
                        </div>
                        <p class="font-bold text-orange-500">{{ item.subtotal|floatformat:0 }}</p>
                    </div>
                    {% empty %}
                    <p class="text-gray-500 text-center py-4">Aucun plat ajouté</p>
                    {% endfor %}
                </div>
                
                <div class="border-t pt-4 mb-6">
                    <div class="flex justify-between text-2xl font-bold">
                        <span>Total</span>
                        <span class="text-orange-500">{{ total|floatformat:0 }} FCFA</span>
                    </div>
                </div>
                
                {% if items %}
                <a href="{% url 'generer_facture' commande.id %}" 
                   class="block w-full bg-orange-500 text-white px-6 py-3 rounded-lg hover:bg-orange-600 font-bold text-center">
                    <i class="fas fa-file-invoice mr-2"></i>Terminer et facturer
                </a>
                {% else %}
                <div class="bg-yellow-50 rounded-lg p-4 text-center">
                    <p class="text-yellow-800 text-sm">Ajoutez au moins un plat</p>
                </div>
                {% endif %}
                
                <a href="{% url 'gestion_tables' %}" 
                   class="block w-full mt-2 border-2 border-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-50 font-semibold text-center">
                    Retour aux tables
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    select, input[type="number"], textarea {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        font-size: 1rem;
    }
    
    select:focus, input:focus, textarea:focus {
        outline: none;
        border-color: #f97316;
        ring: 2px;
        ring-color: #f97316;
    }
    
    textarea {
        min-height: 60px;
    }
</style>
{% endblock %}